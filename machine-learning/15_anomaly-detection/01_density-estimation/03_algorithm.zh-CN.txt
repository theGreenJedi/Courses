在上节课的视频中 我们谈到了高斯分布 在本节视频中 我将应用高斯分布开发异常检测算法 假如说我们有一个无标签的训练集 共有 m 个训练样本 并且 这里的训练集里的每一个样本 都是 n 维的特征 因此你的训练集应该是 m 个 n 维的特征构成的样本矩阵 比如 m 个飞机引擎产品的样本 或者是 来自 m 个用户或者其它的什么东西 现在 我们解决异常检测的方法是 我们要从数据中 建立一个 p(x) 概率模型 我们要尝试计算出这些哪些特征出现的概率比较高 哪些特征的概率较低 因此 x 是一个向量 我们要做的事情是 建立一个 p(x) 的模型 表示 x1 的概率 这是 x 的第一个组成部分 并用它乘以 x2 的概率 这是第二个特征的概率 然后再乘以 第三个特征的概率 一直这样下去 直到最后一个特征  xn 直到最后一个特征  xn 这里我先空着 最后再来填满 那么 我们如何为这些项进行建模呢？ p(x1) p(x2) 等等 我们下面要做的 是假定特征 x1 其分布 服从高斯正态分布 你也可以 写出期望 μ1 以及方差 我用 σ1 的平方表示 这样 p(x1) 就可以写成 这样一个高斯分布 其期望为 μ1 方差为 (σ1)^2 同样地 我假设 x2 也服从高斯分布 这里的小波浪线读作"服从" 表示它服从高斯分布 其期望为 μ2 方差为 (σ2)^2 所以它服从的高斯分布与刚刚那个不同 它的期望和方差都不一样 与此类似 x3 服从另外一个高斯分布 因此 x3 也会有一个不同的期望 以及一个与其它特征不同的标准差 直到 xn 都是如此 这就是我要说的模型 顺便说一下 对那些擅长统计的同学来说 实际上 我刚刚写的式子 写出来实际上就对应于 一个从 x1 到 xn 上的独立的假设 一个从 x1 到 xn 上的独立的假设 但实际中 结果是 这些算法的效果都还不错 无论这些特征 是否独立 即使这个独立的假设不成立 这个算法的效果也还不错 如果你不知道 我刚刚提到的独立事件和其它相关内容 也不要担心 你将会慢慢有能力去理解 并且能很好地实现这些算法 刚才插入的那些内容也不重要 最后 做一个总结 让我把这些式子写得紧凑点 我可以把这个式子 写成一个乘积式 从 j=1 到 j=n 从 j=1 到 j=n 乘积项是 p(xj; μj,  (σj)^2) 也就是 n 个概率的乘积 在这里 出现了一个有趣的符号 希腊字母 Π 这个有趣的字母表示的是 一系列数值的乘积 同时 你应该对求和符号比较熟悉 从 i=1 到 n 求和 也就是 1+2+3+... 直到加到 n 因此刚才的符号 Π 正如这个求和符号 ∑ 一样 只是表示从 i 等于1 到 n 进行连乘 那么 这里的 Π 用法一样 只不过表示连乘而不是连加 这就变成了 1×2×3 一直乘到 n 所以这里用的就是 这里连乘的符号 这个表达式表示从等于 j=1 开始一直乘到 j=n 这样写看起来更紧凑 这样写只是避免了 把这个乘积表达式 的所有项都写出来而已 因为我们需要把 所有的 p(xj; μj,  (σj)^2) 项 全部乘起来 同时 顺便要说的是 估计 p(x) 的分布问题 这种问题通常被称为 密度估计问题 正如幻灯片的标题上写的 把所有的结合起来 下面便是我们的异常检测算法 第一步便是选择特征 或者是找出一些 我们认为的具有比较反常样本 的特征 xi 我的意思是 我们可以尝试 找出一些特征 这些特征能看出比如 在你的系统里有一些不同寻常的用户 可能可以看出他们的反常或欺诈行为 或者是那个飞机引擎的例子 在飞机的众多引擎里有一个奇怪的引擎 选出这种特征 xi 这个特征可能会 呈现一个特别大的数值 或者特别小的数值 因为这个看起来本身就有些异常 但更为普遍的是 尽可能尝试选择能够 描述数据相关的属性的特征 接下来 给出一组 m 个无标签数据构成的训练集 从 x(1) 到 x(m) 我们要拟合出 期望 μ1 到 μn 以及方差值 (σ1)^2 到 (σn)^2 同时 这些公式 和之前视频里的 公式是类似的 因此 我们便可以 估计这些参数的值 我们再说得详细一点 μj 是特征 j 的平均值 因此 μj 对应的模型 就是 p(xj; μj,  (σj)^2) 就是 p(xj; μj,  (σj)^2) 因此 μj 就相当于 对特征 j 的 所有训练集数据取平均值 同时 正如我刚才所讲 你需要对 j 从1到n 计算这些概率值 也就是说用这些公式来估计 μ1 再估计 μ2 直到 μn 同样地 对于 σ^2 也一样 同时 用向量化的方法也可以写出来 所以 你可以把 你把 μ 假想成一个向量 那么向量 μ 就有 μ1 μ2 直到 μn 那么 这个公式的向量表示形式 就能被写出来 μ 的值等于 x(i) 的值 从 i = 1 到 n 求和 再乘以 1/m 因此我刚刚写出的公式 还是用来估计 μ 的值 其中 x(i) 是一系列特征组成的向量 同时包含了所有 n 个值 同样地 我们也可以 写出估计 (σj^2) 的 向量化的公式 最后 当给出一个新样本时 比如当有一个新的飞机引擎时 你想要知道这个飞机引擎是否出现异常 我们要做的就是 计算出 p(x) 的值来 那么这个案例中的概率是多少呢 我们知道 p(x) 的值 等于这个乘积式 你现在 需要用这个公式计算 而这一项 就是乘积项 就是在计算高斯概率 所以你需要计算出这一项 然后看看 如果这个概率值很小 那么你就将这一项标注为异常 这就是我们应用这种方法的一个案例 假如说我们有一系列数据 就是在幻灯片左上角绘制的数据集 让我们看这个特征 x1 如果你看到这个数据集 你会发现它看起来比较平均 x1 这个特征的均值大约是5 并且也有一个标准差 如果你只看 数据集中 x1 的值 其标准差可能为2 所以这一段就是 σ1 然后你再来看第二个特征 从纵轴测量的 特征 x2 看起来其平均值 可能是3 且其标准差值大约为1 如果你使用这个数据集 且如果你估计出 μ1 μ2 σ1 σ2 你就会得到这样的结果 再次说明一下 我在这里写的 σ 表示的是标准差 但先前的公式里给出的 实际上可以将这些项的平方(也就是方差) 也即得到的是σ1的平方 σ2的平方 所以你要仔细一点 注意一下到底在使用σ1 σ2 还是 σ1 σ2 的平方 所以 σ1的平方的值当然等于4 就是 2的平方 在图上 以 μ1 σ1^2 为参数的 p(x1; μ1,σ1^2) 和以 μ2 σ2 为参数的 为参数的 p(x2; μ2,σ2^2) 呈现出像这样的两个分布 实际上 如果绘制 p(x) 的图像 也就是 这两个概率值的乘积 事实上 你会得到一个这样的立体图像 这就是 p(x) 值的图像 我们可以得出 具体的某一点 对应的高度值 给出一个具体的 x1 和 x2 的值 假如 x1 等于2 x2 也等于2 那么就是这个点 在3-D表面图上的高度 就表示 p(x) 值 所以 p(x) 就是这个图的高度 完整地写出来 这个 p(x) 的值等于 p(x1; μ1,σ1^2) 乘以 p(x2; μ2,σ2^2) p(x2; μ2,σ2^2) 现在 我们就知道了如何从数据拟合参数 让我们看看一些新的样本 假如在这里我们有了一个新样本 我要知道这个样本是否异常 或许我还有另一个样本 比如我在这里有第二个新样本 这个样本又是否异常呢? 要回答这个问题 我们可以先给计算机设某个无穷小的数值 假如我设置的 无穷小量数值为0.02 我会在后面讲到如何选取 ε 的值 不过 我们先看第一个样本 我们把这个称为 x(1)test 同时 称第二个样本为 x(2)test 我们现在要做的 是计算 p(x(1)test) 我们用上面这个公式 就能计算出来 不难发现这是一个相当大的数 具体地 这个值可能大于 或者大于等于 ε 值 相较于计算机的无穷小量 ε 这个数值是比较大的 所以我们说 x1 检测的结果是 不是异常 然而 如果你计算 p(x(2)test) 会是一个更加小的数 比 ε 还要小很多 那么我们会说 x2 确实是一个异常数值 因为那已经远远小于了先前我们定义的 ε 值 但事实上 我们也可以对这个方法进行改进 看这个三维表面图 从图上不难发现 在这个图的中间部分的x1 x2 通常都对应于 一个比较高的表面值 预示着非异常样本 或者正常样本 而在周围边缘的点 这些桃红色的区域 所有这些区域 对应的概率值 都是非常小的 因此我们会标记这些点 为异常样本区域 所以 我们也许可以 定义某个区域 像这样 在这个外面的 标记为异常区域 而在这个里面的 可以标记为非异常区 表示无异常的样本 所以这个测试样本 x(2)test 处于无异常区之外 也就是说 它所对应的概率值很小 因此认为它是一个异常样本 在这段视频中 我们介绍了如何拟合 p(x) 也就是 x 的概率值 以开发出一种异常检测算法 同时 在这节课中 我们也给出了 通过给出的数据集 拟合参数 进行参数估计 得到参数 μ 和 σ 然后检测新的样本 确定新样本是否是异常 这一系列完整的过程 在接下来的课程中 我们将深入研究这一算法 同时更深入地介绍 怎样让算法工作地更加有效 【教育无边界字幕组】翻译：Yuens 校对/审核：所罗门捷列夫