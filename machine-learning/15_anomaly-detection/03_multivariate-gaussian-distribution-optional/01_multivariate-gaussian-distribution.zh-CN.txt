在这节和下节视频中 我想给你介绍 我们目前为止学习的异常检测算法的 一种可能的延伸 这个延伸使用了 多元高斯分布 (multivariate Gaussian distribution) 它有一些优势 也有一些劣势 它能捕捉到一些之前的算法检测不出来的异常 为了理解这个算法 我们先来看看一个例子 假设我们的没有标签的数据看起来像这张图一样 我要使用数据中心的监控机的例子 我要使用数据中心的监控机的例子 就是在数据中心监控计算机的例子 所以我的两个特征变量 x1 是 CPU 的负载和 x2 可能是内存使用量 所以如果我 把这两个特征变量 x1 和 x2 当做高斯分布来建模 这个是特征变量 x1 绘制的图 这个是特征变量 x2 的图 如果我能找到一个 它所符合的高斯分布 我得到的高斯分布可能是这样的 所以这是 p(x1; 它的参数 µ1 它的参数 µ1 和 σ1 的平方 ) 然后这是内存使用量 可能我会得到这样的一个高斯分布 这是 p(x2; 参数 µ2 和 σ2 的平方 ) 因此这就是一个 异常检测算法对 x1 和 x2 建模的方法 现在假如说 在测试集中 有一个这样的样本 在这个绿色叉的位置 它的 x1 的值是 0.4 左右 x2 的值是 1.5 左右 现在 如果你看看 看起来它们大部分 看起来它们大部分 都在这个范围内 所以这个绿色叉 离这里看到的任何数据都很远 看起来它应该被当做 一个异常数据 所以我的 好的样本的数据 看起来 CPU 负载 和内存使用量 是彼此线性增长的关系 所以 如果我有一台机器 CPU 使用量很高 那么你就知道 内存使用量也会很高 但是这个绿色样本 看起来 CPU 负载很低 但是内存使用量很高 我以前从没在 训练集中见过这样的 看起来它应该是异常的 但是我们来看一下异常检测算法会怎么做 对于 CPU 负载 这个绿色叉差不多在 0.5 这里 有相当高的可能性 它离看到的其它样本不远 它离看到的其它样本不远 相对的 对于内存使用量 这个点是 0.5 而对于内存使用量 它是差不多 1.5 在那里 它在这个高斯分布的尾部 它在这个高斯分布的尾部 但是这里的值和这里的值 与看到的其他那些样本 没有太大差别 所以 p(x1) 会很高 所以 p(x1) 会很高 会比较高 p(x2) 也会比较高 我的意思是 如果你看这幅图 这里这个点 看起来它并没那么差 然后如果你看这幅图 这个叉 看起来也不那么差 我的意思是 有的样本 内存使用量更高 或者 CPU 使用量更低 所以这个点看起来不是很异常 所以 一个异常检测算法 不会将这个点标记为异常 可以看出来 我们的异常检测算法 不能察觉到 不能察觉到 这个蓝色椭圆所表示的 好样本概率高的范围 它所做的是 这部分样本是高概率的 外面一些的圈里面的样本 是好样本的概率低一些 而这里的样本概率更低 然后事情就变成了 那里的绿色叉 是好样本的概率挺高 具体来说 它倾向于认为所有在这区域中的 在我画的这个圈上的样本 都具有相同的概率 它并不能意识到 这边的其实比那边的 概率要低得多 所以 为了解决这个问题 我们要开发一种 改良版的异常检测算法 改良版的异常检测算法 要用到一种 叫做多元高斯分布或者多元正态分布的东西 所以这是我们要做的 我们有特征 x 它是 n 维实数 我们不要把 p(x1) p(x2) 分开 而要建立一个 p(x) 整体的模型 就是一次性建立 p(x) 的模型 多元高斯分布的参数 包括向量 µ 和一个 n×n 矩阵 Σ Σ 被称为协方差矩阵 它类似于我们之前 在学习 PCA 也就是主成分分析的时候 也就是主成分分析的时候 所见到的协方差矩阵 我们来试着完成这个 让我来写出 多元高斯分布的公式 我们说 x 的概率 确定它的参数是 我的参数 µ 和 Σ 我的参数 µ 和 Σ x 的概率等于 再说一次 完全没有必要去记这个公式 因为你可以在 任何需要用它的时候找到它 但是 x 的概率 看起来是这样的 转置 Σ 的逆 x-µ 这边这个东西 Σ 的绝对值 当我们写这个符号的时候 这个东西叫做 Σ 的行列式 (determinant) 它是一个矩阵的数学函数 你不需要知道 你不需要知道 矩阵的行列式是什么 你真的需要知道的 就是可以在 Octave 里 使用 Octave 命令 det(Sigma) 来计算它 det(Sigma) 来计算它 好 再确认一次 在这个表达式中 这些 Σ 是 n×n 矩阵 这不是一个求和符号 这个 Σ 是一个 n×n 矩阵 所以那就是 p(x) 的公式 但是更有趣 或者说更重要的是 p(x) 到底是什么样子 我们来看一些 多元高斯分布的例子 我们来看一个二维的例子 我们来看一个二维的例子 如果我有 n 等于 2 两个特征 x1 和 x2 如果说我让 µ 等于 0 如果说我让 µ 等于 0 让 Σ 等于这个矩阵 让对角线上的值等于 1 非对角线上的值等于 0 这个矩阵有时会被叫做单位矩阵 (identity matrix) 在这个情况下 p(x) 看起来会是这样 我在这个图里展示的是 我在这个图里展示的是 对于一个特定的 x1 的值 和一个特定的 x2 的值 这个面的高度 这个面的高度 就是 p(x) 的值 所以在这个参数设定下 p(x) 在 x1 和 x2 都等于 0 时最高 那就是高斯分布的峰值 然后这个概率 这个二元高斯分布 随着这个二维钟形的面衰减 下面这个图和上面是一样的 但它是用等高线 或者说不同颜色画的图 所以中间这里这个 很强烈的暗红色 对应的是最高值 然后这个值降低 黄色表示低一点儿的值 青色表示更低一些的值 这里的深蓝色 表示的是最低的值 所以这个其实是同一张图 就是采用俯视的角度 并且使用了颜色 所以 从这个分布 你可以看出来 大部分概率都在 0 0 附近 然后 随着从 0 0 这个点往外延伸 x1 和 x2 的概率下降 现在我们来试试 改变一些参数 然后看看会发生什么 我们来改变一下 Σ 假如说缩小一下 Σ Σ 是一个协方差矩阵 所以它衡量的是方差 所以它衡量的是方差 或者说特征变量 x1 和 x2 的变化量 所以如果缩小 Σ 那么你的得到的是 那么你的得到的是 这个鼓包的宽度会减小 高度会增加一点 因为在这个面以下的 区域等于 1 所以这个面以下的 体积的积分等于 1 因为概率分布的积分 必须等于一 但是 如果你缩小方差 相当于缩小 Σ 的平方 相当于缩小 Σ 的平方 你会得到一个窄一些 高一些的分布 在这儿你也看到 这些同心椭圆也缩小了一些 而相对的 如果你 增加 Σ 对角线上的值到 2 2 所以它现在是单位矩阵的二倍 那么最后你会得到 一个更宽更扁的高斯分布 所以这个的宽度会更宽 虽然很难看出来 但这还是一个钟形的鼓包 它只是扁平了很多 它变得更宽了 所以 x1 和 x2 的方差 或者变化量变大了 下面再举几个例子 现在我们试一下 一次改变 Σ 的一个元素 假如说我把 Σ 改为这里是 0.6 那里是 1 它所做事情的是 减小第一个特征变量 x1 的方差 减小第一个特征变量 x1 的方差 同时保持第二个特征变量 x2 的方差不变 在这个参数设置下 就可以给这样的东西建模 x1 有小一些的方差 而 x2 有大一些的方差 然而如果我这样做 把这个矩阵设置为 2 1 把这个矩阵设置为 2 1 那么你也可以 建立这样的模型 x1 的变化范围比较大 x1 的变化范围比较大 而 x2 的变化范围则窄一些 它也被反映到这张图上了 它也被反映到这张图上了 这个分布随着 x1 远离 0 这个分布随着 x1 远离 0 下降得更缓慢 而随着 x2 远离 0 下降得非常快 类似地 如果我们改变 矩阵的这个元素 那么会类似于上一页 除了在这儿 我们说 x2 的变化区间非常小 我们说 x2 的变化区间非常小 我们说 x2 的变化区间非常小 所以在这里 如果这个是 0.6 我们发现现在 x2 的变化区间 比原来的例子要小很多 然而如果我要让 Σ 等于 2 然而如果我要让 Σ 等于 2 这就是说让 x2 有大一些的变化区间 现在 多元高斯分布的 现在 多元高斯分布的 一个很棒的事情是 你可以用它给数据的 相关性建立模型 我们可以用它 来给 x1 和 x2 高度相关的情况 建立模型 所以具体来说 如果你改变协方差矩阵 非对角线上的元素 你会得到一种不同的高斯分布 所以当我将非对角线的元素 所以当我将非对角线的元素 从 0.5 增加到 0.8 时 我会得到一个 更加窄和高的 沿着 x=y 这条线的分布 然后这个等高线图告诉我们 x 和 y 看起来是 一起增加的 概率高的地方是这样的 概率高的地方是这样的 要么 x1 很大 x2 也很大 或者 x1 很小 x2 也很小 或者是这两者之间 然后随着这个值 0.8 增大 你会得到这样一个高斯分布 差不多全部的概率 都在一个很窄的范围内 也就是 x 几乎等于 y 它是一个非常高 而且非常薄的分布 几乎完全在 x 非常接近于 y 的这样一个 几乎完全在 x 非常接近于 y 的这样一个 非常窄的范围内 这是当我们把这些元素 设置为正数时的情况 相对地 如果我们 将它们设置为负数 随着我把它从 -0.5 减小到 -0.8 那么我得到的模型是 大部分的概率都在 x1 和 x2 负相关的这样一个区域内 x1 和 x2 负相关的这样一个区域内 那么大部分的概率 几乎都落在 x1 和 -x2 差不多相等的区间内 而不是 x1 等于 x2 的区间 而不是 x1 等于 x2 的区间 所以这个捕捉到了 x1 和 x2 的负相关性 x1 和 x2 的负相关性 因此这就是一个 能让你体会到 多元高斯分布所能展现的 不同的分布 到目前为止 我一直在改变协方差矩阵 Σ 你还可以做的事情是 改变平均值参数 µ 改变平均值参数 µ 我们的 µ 本来是等于 0 0 的 我们的 µ 本来是等于 0 0 的 所以分布才会集中在 x1=0 x2=0 这个点周围 所以这个分布的峰值在这里 所以这个分布的峰值在这里 而如果我们改变 µ 的值 它就会改变 这个分布的峰值 所以如果 µ 等于 0 0.5 这个峰值就在 x1=0 x2=0.5 这里 所以这个分布的 峰值或者说中心 就会被移动 如果 µ 等于 1.5 -0.5 那么还是同样地 现在分布的峰值 就会被移动到 另一个地方 这个新地方就对应 x1=1.5 x2=-0.5 这个点 所以改变参数 µ 就是在移动 这整个分布的中心 所以 希望这些 不同的图片 能够帮助你了解一下 多元高斯分布 所能描述的概率分布是什么样的 它最重要的优势 就是它可以让你 能够描述当两个特征变量之间 可能存在正相关 或者是负相关关系的情况 在接下来的视频中 我们要把这个多元高斯分布 应用到异常检测中 【教育无边界字幕组】翻译: 竹二个 校对/审核: 所罗门捷列夫