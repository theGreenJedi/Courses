在上一节视频中 我们谈到了多元高斯分布 而且也看到了一些例子 通过改变参数 µ 和 Σ 来给不同的概率分布建模 在这节视频中 我们来使用那些想法 用它们来开发另一种异常检测算法 再回顾一下多元高斯分布 或者叫多元正态分布 有两个参数 µ 和 Σ µ 是一个 n 维向量 协方差矩阵 Σ 是一个 n 乘 n 矩阵 是一个 n 乘 n 矩阵 这个式子是 x 的概率分布 这个式子是 x 的概率分布 参数是 µ 和 Σ 随着你改变 µ 和 Σ 随着你改变 µ 和 Σ 你可以得到一系列 不同的概率分布 这里有三个例子 我们在上节视频中见过 接下来 让我们谈一下 参数拟合问题 或者说参数估计问题 和往常一样 问题是 如果我有一组样本 从 x(1) 到 x(m) 这里的每一个样本 都是 n 维向量 而且我认为它们服从多元高斯分布 我应该怎么估计参数 µ 和 Σ 呢？ 估计它们的 标准公式是这样的 µ 等于你的 训练样本的平均值 让 Σ 等于这个式子 这个 Σ 实际上 就是我们在使用 PCA 就是我们在使用 PCA 或者说主成分分析法时 所写的 Σ 的式子 然后你把数据代入到 这两个式子中 就得到了估计值参数µ 和估计值参数Σ 所以 当给定数据集时 就这样来估计 µ 和 Σ 我们来使用这个方法 把它用到 异常检测算法中 那么我怎么把这些放在一起 那么我怎么把这些放在一起 来开发一个异常检测算法呢？ 我们这样做 首先 用我们的训练集 来拟合模型 p(x) 来拟合模型 p(x) 你知道 就是要让 µ 和 Σ 等于 上一页所描述的这样 然后 等你拿到 一个新样本 x 如果你拿到一个测试样本 我们还用之前的例子 拿到的新样本在这里 那是我的测试样本 拿到一个新样本 x 我们要做的就是 用这个多元高斯分布的公式 来计算 p(x) 然后 如果 p(x) 非常小 那我们就把它标记为一个异常点 那我们就把它标记为一个异常点 而如果 p(x) 大于那个参数 ε 那我们就不把它标记为异常点 所以说 如果我们要用一个多元高斯分布来拟合这个数据集 指的是这些红色叉 不是绿色样本 你会得到一个这样的高斯分布 大部分的概率在中间这个区域 大部分的概率在中间这个区域 这里的概率稍微低一些 这里的概率再稍微低一些 这里的概率再稍微低一些 远处这个点的概率非常低 所以 当你 在这个样本上用多元高斯分布 它实际上会 正确地把那个样本 标记为一个异常点 最后 应该稍微说一下 多元高斯分布模型 多元高斯分布模型 和原来的模型 它们之间的关系 p(x) 原来的模型是 p(x1) 乘以 p(x2) 一直乘到 p(xn) 的积 p(x1) 乘以 p(x2) 一直乘到 p(xn) 的积 p(x1) 乘以 p(x2) 一直乘到 p(xn) 的积 事实上 你可以从数学上证明 我不打算在这里进行证明 但是你可以从数学上证明 多元高斯模型 和原来的模型 之间的关系 详细来说就是 事实上原来的模型 对应于一种多元高斯分布 它的等高线 全部都是沿着轴向的 所以这三个 全都是你可以用 原来的模型来拟合的 高斯分布的例子 事实上 它对应于 这样的多元高斯分布 这样的椭圆 这样的分布等高线 事实上这个模型 实际上它对应于一种 多元高斯分布的特例 具体来说 这个特例被定义为 约束 p(x) 的分布 也就是多元高斯分布 p(x) 也就是多元高斯分布 p(x) 使得它的概率密度函数的等高线 使得它的概率密度函数的等高线 或者说概率分布函数的等高线 是沿着轴向的 所以你可以得到 多元高斯分布 p(x) 看起来是这样 或者是这样 或者是这样 然后你发现 在这3个例子 或者说我所画的这些椭圆中 它们的轴都是沿着 x1 x2 的轴的 在其中没有 带有角度的 一组等高线 这个对应于那个 Σ 等于 1 1 0.8 0.8 的例子 就是非对角线上有 非零元素的例子 所以 事实上 可以用数学证明 这个模型实际上 和多元高斯分布一样 只是有一个约束 这个约束是 协方差矩阵 Σ 必须满足 非对角线的元素为0 具体来说 协方差矩阵 Σ 也就是这里这个 它等于 σ1 ^2 σ2^2 一直到 σn^2 它等于 σ1 ^2 σ2^2 一直到 σn^2 然后 所有 非对角线上的项 所有这些在矩阵对角线 之上或者之下的元素 所有这些全都等于0 实际上如果你 把这些 σ σ1^2 σ2^2 把这些 σ σ1^2 σ2^2 一直到 σn^2 把它们代入到这里 把它们代入到 这个协方差矩阵中 那么这两个模型实际上就完全一样了 就是说 这个新模型 使用多元高斯分布来看 刚好对应于这个旧模型 如果这个协方差矩阵 Σ 在非对角线上的元素 只有0的话 从图上来看 它对应于 分布函数的等高线 是沿着轴向的高斯分布 所以你不能给不同特征变量之间的相关性建模 这样看来 原来的模型 实际上是这个多元高斯模型的一个特例 所以你应该在什么时候用哪个模型呢？ 什么时候该用原来的模型 什么时候该用 多元高斯模型呢？ 原来的模型 可能使用得更加频繁 而多元高斯模型 则没有那么常用 但是它有能够捕捉 特征变量之间的相关性的优势 如果你想捕捉到这样的异常 如果你想捕捉到这样的异常 你有不同的特征变量 比如说特征变量 x1 x2 的值的组合是不正常的 在之前的例子中 我们的异常的例子是 CPU 负载和内存使用量的值的组合是不正常的 如果你想用原来的模型 捕捉到这个情况 你需要建立一个新特征变量 你需要建立一个新特征变量 比如说 x3=x1/x2 可能是等于 CPU 负载除以内存使用量 或者别的什么 你需要建立一个新特征变量 如果有不正常的变量值组合这种情况 也就是说 x1 和 x2 的取值 的组合是不正常的 虽然 x1 自己 和 x2 自己的值 看起来非常的正常 但是如果你愿意花时间 手动建立这样的新特征变量 那么原来的模型可以很好地运行 而相对地 多元高斯模型可以自动捕捉 不同特征变量之间的相关性 但是原来的模型也有一些其他的很重要的优势 其中一个很大的优势就是 它的运算量更小 换种说法是 它更适用于 n 的值非常大 就是说特征变量很多的情况 所以即便 n 等于 10,000 或者 n 等于 100,000 原来的模型 通常都可以很好地运行 而对于多元高斯模型要注意 例如 我们要计算 矩阵 Σ 的逆矩阵 在这里 Σ 是一个 n 乘 n 的矩阵 所以如果要计算的 Σ 是一个 100,000 乘 100,000 的矩阵 那么这个计算量会非常大 所以多元高斯模型 不是非常适合 n 很大的情况 最后 对于原来的模型 事实上 即使你的训练集相对较小 它也能运行得还可以 这是我们用来给 p(x) 建模的 无标签的小训练集 当然 这个运行得很好 即使 m 可能是 50 或者 100 也工作得很好 而对于多元高斯模型 这个算法的数学性质要求 你的 m 必须大于 n 所以样本的数量要大于特征变量的数量 我们估计参数的方法有个数学性质是 如果不满足这个条件 就是说 m 小于或等于 n 那么这个矩阵是不可逆的 是奇异矩阵 如果你不能改变这个的话就不能使用多元高斯模型 但是我所使用的典型的经验法则是 我只在当 m 远大于 n 的时候 使用多元高斯模型 所以这是一个比较严格的数学要求 但是在实际中 我只有在 m 比 n 大很多的情况下 才使用多元高斯模型 所以如果 m 大于等于十倍的 n m 大于等于十倍的 n 这可能是个合理的经验法则 如果它不满足这个 那么多元高斯模型 有很多的参数 对吧 这个协方差矩阵 Σ 是一个 n 乘 n 矩阵 所以它大概有 n 的平方个参数 因为它是个对称矩阵 实际上它有大概 n 平方除以 2 个参数 实际上它有大概 n 平方除以 2 个参数 但这是非常多的参数 所以你需要确保你的 m 比较大 确保你有足够的数据来拟合这些参数 m 大于等于十倍的 n 是一个比较合理的经验法则 它能确保你对协方差矩阵 Σ 的估计比较好 所以在实际应用当中 左边这个原来的模型比较常用 如果你觉得 你需要捕捉特征变量之间的相关性 一般人就会手动增加这样的额外特征变量 来捕捉特定的不正常的值的组合 但是在你的训练集很大 或者说 m 很大 n 不太大的情况下 那么多元高斯模型 是值得考虑得 或许可以运行得更好 还可以帮你省去 为了捕捉不正常的特征值组合 才能捕捉到的异常 而手动建立额外特征变量 所花费的时间 最后我只想 简单提一个技术上的性质 如果你想拟合 多元高斯模型 如果你发现 协方差矩阵 Σ 是奇异的 或者说你发现 它是不可逆的 一般只有两种情况 第一种是它没有满足 这个 m 大于 n 的条件 第二种情况是 你有冗余特征变量 冗余特征变量的意思是 如果你两个一样的特征变量 不知怎么你不小心把同一个特征变量 复制了两份 那么你的 x1 刚好等于 x2 或者如果你有像这样的冗余数据 可能是 x3=x4+x5 好了 如果你有像这样 高度冗余的特征变量 如果 x3=x4+x5 那么 x3 就不含有 任何额外的信息 对吧？ 就只是把另外两个特征变量加起来而已 如果你有这样的 冗余特征变量 重复特征变量 或者这样的特征变量 那么 Σ 就会是不可逆的 这是调试时候的小知识 这个应该很少发生 所以你可能不会碰到这个问题 你可能不太需要担心这个 但是万一在你实现 多元高斯模型的时候发现 Σ 是不可逆的 我会做的首先是 确保 m 比 n 大很多 如果是这样 那么我做的第二件事是 检查冗余特征变量 如果有两个特征变量相等 就删掉其中一个 就删掉其中一个 如果你的冗余数据是 x3=x4+x5 这样的 就删掉容易的特征变量 然后它应该就可以很好地运行了 对你们之中那些 了解线性代数的人 我所说的冗余特征变量 它的正式用语是 线性相关的特征变量 但是在实际中它的意思就是 这些之中的问题导致算法有问题 如果你确保特征变量没有冗余的 应该就能解决 Σ 不可逆的问题 但是再说一次 你遇到这个问题的可能性 非常低 你可以直接应用 多元高斯模型 不需要担心 Σ 不可逆的问题 只要 m 大于等于 n 只要 m 大于等于 n 这就是应用多元高斯分布 的异常检测算法 如果你使用这个方法 你就可以使你的 异常检测算法 自动捕捉不同特征变量之间的 正相关或负相关性 并且在特征值的组合 不正常的时候 将它标记为异常 【教育无边界字幕组】翻译：竹二个 校对/审核：所罗门捷列夫