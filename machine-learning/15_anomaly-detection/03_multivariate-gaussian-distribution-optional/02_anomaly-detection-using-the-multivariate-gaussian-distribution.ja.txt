前回のビデオで 多変量ガウス分布を議論した。 そしてパラメータのミューとシグマを変えていく事で モデリング出来る分布の例を 幾つか見た。 このビデオでは、それらのアイデアを用いて、 別のアノマリー検出のアルゴリズムを 開発していこう。 復習しておくと、多変量ガウス分布、またの名を 多変量正規分は、 二つのパラメータ、ミューとシグマを持っている。 ここでミューは n次元ベクトルで、 シグマ、共分散行列は、 n掛けるn行列。 そしてこれがxの確率の 式である、 ミューとシグマでパラメトライズされた。 そしてミューとシグマを 変更していく事で、 あなたは様々な範囲の分布を 得る事が出来る、 例えばこれら三つの例は 我らが前回のビデオで見た、そんな物の中の一例だ。 ではパラメータのフィッティングについて 議論しよう、言い換えると パラメータ推計の問題について。 問いは、いつも通り、 x1からxmまでの手本の集合が あったとして、そしてここでは これらの手本はおのおの n次元ベクトルで、 そしてこの手本は多変量ガウス分布の分布に従っている、と思ったとする。 どうやってパラメータ、ミューとシグマを推計したらいいだろうか？ それらを推計する 標準的な公式は、 ミューにトレーニング手本の 平均をセットすれば良い。 そしてシグマにはイコールこれを。 これは実際に、 PCA、あるいは主成分分析を 使った時に 我らが書き下した物と 同様の物だ。 さて、これら二つの式に 代入するだけで、 推計されたパラメータ、ミューと、 推計されたパラメータのシグマが得られる。 つまりデータセットが与えられた時に、ミューとシグマを推計する方法だ。 ではこの手法を アノマリー検出のアルゴリズムに 組み込んでみよう。 では、どうやったら 我らはこれらを全て組み合わせて アノマリー検出のアルゴリズムを開発出来るだろうか？ 我らがやるべきは、こうだ。 まず、トレーニングセットに対し、 モデルをフィッティングする、 p(x)をフィッティングする、 前のスライドで記述した ミューとシグマを 設定する事で。 次に、新しい手本xが 与えられた時に、 テストの手本が与えられたとすると、、、 前の例から、新しい手本をここに得たとしよう。 これが私のテスト手本。 新しい手本xが与えられた時に、 我らがやる事は、p(x)を計算する事、 この多変量ガウス分布の式を 用いる事で。 そして次に、 p(x)がとても小さかったら、 それをアノマリーとフラグ立てする。 他方、p(x)がパラメータのイプシロンより 大きければ、 それにはアノマリーのフラグは立てない。 つまり結局、もしこのデータセットに多変量ガウス分布をフィッティングするとすると、 このデータセットというのは赤のクロスで、緑の手本は含まないが、 そうすると結局、 以下のようなガウス分布が得られる： 中心の領域にたくさんの確率を、 ここにはちょっとだけ低い確率を、 ここにはさらにちょっとだけ低い確率を、 ここにはさらにちょっとだけ低い確率を、 そしてここより外はとても低い確率となるような物だ。 つまり、この例で 多変量ガウス分布を 適用すると、これは実際に ただしくこの手本をフラグ立てする、 アノマリーだと。 最後に、多変量ガウス分布モデルと 元のモデルとの間の関係について 2, 3言っておく 価値があるだろう、 ここで元のモデルとは、 p(x)を p(x1), p(x2), ..., p(xn)までの 積でモデリング したもの。 以下の事が数学的に証明出来る事が 知られている。 ここで証明はしないが。 だが、多変量ガウス分布のモデルと オリジナルのモデルの間の この関係を 数学的に証明する事が出来る。 より詳細には、 オリジナルのモデルは、 多変量ガウス分布の、ガウス分布の等高線が いつも軸に沿っている場合に対応している事が 知られている。 つまり、これら三つは全て オリジナルのモデルを使って フィッティングする事が可能な ガウス分布の例だ。 これは結局、 多変量ガウス分布のうち、 この楕円、 分布の等高線が、、、 このモデルは実際に 多変量ガウス分布の 特別なケースに対応している。 具体的には、この特別なケースとは、 p(x)の分布、 多変量ガウス分布としてのp(x)の分布を、 確率密度関数の、、、 確率分布関数の等高線を 軸に沿った物に 制限した物、として 定義する事が出来る。 つまり多変量ガウス分布の p(x)として、 このような物や、 このような物、またはこのような物を、得る事が出来る。 そして見て分かるように、 これら三つは全て、これらの楕円は、 または私が今描いた楕円は、 その軸がx1 x2軸に沿っている。 そして我らが持っていない物として、 角度のある等高線の 集合だ。でしょ？ そしてこの事は、シグマがイコール 1, 1とか0.8, 0.8などの例に対応した物で、 非対角成分に非0成分が 存在していないという事。 つまり、このモデルは 実際に多変量ガウス分布に 制約を加えた物である、という事を 数学的に証明出来る事が 知られている。 そしてその制約とは、 共分散行列のシグマは 非対角成分が0でなくてはならない、とい事だ。 具体的に言うと、共分散行列シグマは ここのこれは、 シグマ二乗1、シグマ二乗2,、、、と シグマ二乗nまでと、 そしてそれ以外の全ての 非対角成分の要素は、 行列の、対角線より上側のこれら全てと、 下側のこれら全て、 それら全てが、ゼロとなる。 そして実際、もしこれらの シグマの値、 シグマ二乗の1, シグマ二乗の2,...と シグマ二乗のnまでの値を、 ここに代入して、 この共分散行列に 代入すると、 二つのモデルは、実際に同一となる。 つまり、この新しいモデル、 多変量ガウス分布を用いたこのモデルは、 古いモデルと厳密に一致する、 もし非対角成分が 全てゼロとなるような 共分散行列のシグマの場合には。 それは具体的には、 ガウス分布のうち、 この分布関数の等高線が 軸に沿っている物に対応している。 だから異なるフィーチャー間の相関をモデリングする事は許されていない。 つまりその意味で、オリジナルのモデルは、 実際に多変量ガウス分布のモデルの特別な場合となっている。 では、どういう場合に、これら二つのモデルのどちらを使ったらいいか？ つまりあなたはいつ、オリジナルのモデルを使うべきで、 そしてあなたはいつ、多変量ガウス分布のモデルを 使うべきなのだろうか？ オリジナルのモデルは、 おそらくより頻繁に用いられるだろう、 一方で多変量ガウス分布はおそらく より少ししか用いられないだろう、 だがそちらの方には、フィーチャー間の相関を 捉える事が出来る、という利点がある。 つまり、例えば 異なるフィーチャー同士、 ここではフィーチャーx1, x2としよう、 これらのフィーチャー同士の 異常な組み合わせの値となるアノマリーを検出したいとしよう、 つまり前の例で言うと、 CPUロードとメモリ使用量が異常な値の組み合わせとなっているアノマリーの手本があった。 もしオリジナルのモデルを使って これを捉えたいと思えば、 あなたはこんな追加のフィーチャーを 作る必要がある、それは 例えば x3=x1/x2 みたいな。 つまりイコール、(CPUロード)/(メモリ使用量) とかみたいな。 つまり、追加のフィーチャーとして、 x1とx2が異常な 組み合わせの値となる時は、 たとえx1単体とx2単体で見た場合に どちらも完全に正常だとしても、 異常な値となる追加のフィーチャーを 作り出す必要がある。
だが、もしこのような追加のフィーチャーを 作る事に喜んで時間を差し出せるなら、 オリジナルなモデルはちゃんと機能するだろう。 一方、対照的に、多変量ガウス分布のモデルは、自動的に フィーチャー同士の相関を捉える事が出来る。
しかしオリジナルのモデルには、他にも重要な利点がある。 そんな利点のうち大きな物としては、 オリジナルのモデルの方が計算量的に安上がりだ、という事。
これを別の見方をすると、 これは非常に大きなnの値に、 つまり非常に大きなフィーチャーの数に より良くスケールする。 だから、たとえ nが1万とか、 またはnが10万とかでも、 オリジナルのモデルは 割と普通に動く。 他方、対照的に多変量ガウス分布のモデルでは、例えばここを見ると、 行列シグマの逆行列を 計算する必要があり、 このシグマは n掛けるn行列だ。 つまり、シグマで計算する時には、 シグマが 10万掛ける10万 の行列の時には、 計算量的にとても高価になってしまう。 つまり、多変量ガウス分布のモデルは、 大きなnの値に対しては、 相対的には、よりいまいちスケールしない。 そして最後に、オリジナルの方のモデルでは、 たとえトレーニングセットが 相対的に小さくても、 うまく機能する事が分かっている。 これはp(x)をモデリングする時に用いる ラベル無しのトレーニング手本が小さくても、 うまく機能する、 たとえmが、 50とか100でも、たぶんうまく機能する。 他方、多変量ガウシアンでは、 アルゴリズムにある種の数学的な 性質があって、mはnより大きくないといけない。 つまり、手本の数は、フィーチャーの数よりは大きくないといけない。 もしこれが真で無いと、つまりmがn以下だと、 この行列が可逆じゃなくなる、つまりこの行列が特異行列となり、何かしら変更しないと 多変量ガウス分布のモデルは、使う事すら出来ない。 だけど典型的なルールとしての経験則として 私が採用しているのは、 私はmがnよりもずっと大きい時しか多変量ガウス分布は使わない、という物。 つまりこれは、実際的な物よりちょっと狭い数学的な要求と言える。 実際には、私は 多変量ガウス分布のモデルは、 mがかなりnより大きい時しか 使わない。 例えばmが 10掛けるn 以上なら、とかは、 リーズナブルな経験則と言えそう。 そしてこれを満たしていなければ、、、多変量ガウス分布のモデルが たくさんのパラメータを持っていると、 この共分散行列シグマはn掛けるn行列なので、 これはだいたいn二乗のパラメータを持つ、 これは対称行列だから、 実際は n二乗割る2 に近いくらいの パラメータだが。 だが、これは大量のパラメータだ。 だからかなり大きな値のmがあるという事を保証しておく必要がある。 これらのパラメータの全てにフィッティングするだけの、十分なデータがある事を保証しておく必要がある。 そこでmが10n以上、というのは、この共分散行列を推計出来る為の、リーズナブルな経験則と言えるだろう。 さて、実践の場では、 左に示したオリジナルのモデルの方が、より頻繁に使われる。 そしてもしあなたが、フィーチャー同士の相関を 捉える必要があるんじゃないか、と思っているなら、 そういう時は人々はよく、単に人力でそれらの異常な値の組み合わせを捉える 追加のフィーチャーをデザインする、という事をする。
だが、とても大量のトレーニングセットを持っていて、 つまりmがとても大きくて、そしてnがそんなに大きく無いような問題に 直面している時は、多変量ガウス分布のモデルは、 検討してみる価値があり、よりうまく機能する事もあり、 異常なフィーチャーの値の組を 捉える結果となるような 追加のフィーチャーを 人力で作るのに時間を費やさずに 済ます事が出来るかもしれない。 最後に、いくらかテクニカルな性質だが、 ちょっと簡単に触れておきたい事がある。 多変量ガウス分布の モデルをフィッティングする時に、 もし共分散行列のシグマが 特異行列だと 見出したら、あるいはそれが非可逆だと 見出したら、それには普通、二つの場合がある。 一つ目は、 このmがnより大きい、という条件を 満たしていない場合。 二番目は、冗長なフィーチャーがある場合。 冗長なフィーチャーという言葉で私が意味している事は、 同一のフィーチャーが二つある、という事。 どうにかして、偶然二つのコピーのフィーチャーを作ってしまった、つまり x1は単に、イコールx2であるようなフィーチャーを作ってしまった、だとか、あるいは例えば フィーチャーx3 = フィーチャーx4+フィーチャーx5
のような冗長なフィーチャーがあるという場合。 オーケー。で、このような とても冗長なフィーチャーがある場合、 もしx3=x4+x5なら、 x3は何も追加の情報を 含んでいない。 単にこれら二つの別のフィーチャーを、足し合わせるだけだ。 そしてもしあなたがこの手の冗長な、 重複したフィーチャーとかこの種のフィーチャーを 保持している時には、シグマは非可逆になってしまう。 以上はデバッギングの時の豆知識だ。 これは本当に稀にしか起こらないはずで、 だからあなたが鉢合わせする事も多分無いだろう。 これは、あなたが心配するにはあまりにもレア過ぎる。 だがあなたが多変量ガウス分布のモデルを 実装してみて、シグマが非可逆だという事を発見したら、 私だったらまず、 mがnよりもずっと大きい事を 確認し、もしそうであるなら、次に 二番目に私がやる事は、 冗長なフィーチャーをチェックする事だ。 そして、もし単純に等しい二つのフィーチャーが ある時には、 一方を取り除けば良い。 そしてもしx3=x4+x5のような 冗長なフィーチャーがある時には、 その冗長なフィーチャーを取り除けば良い。 そうすればまた正常に機能するようになるだろう。 線形代数のエキスパートの聴衆の為に ちょっと脇道に逸れると、 冗長なフィーチャー、という言葉で 私が意味している事の正式な用語は、 フィーチャーが線形に従属している、という事。 だが実践に際しては、それが実際に意味している事は、 これらの問題の一つがアルゴリズムをつまづかせていたら、 あなたはフィーチャーを冗長では無くすだけで、 シグマが非可逆、という問題を解決出来るはずだ。 だがもう一度繰り返しておくと あなたが生涯でこの問題に遭遇するという事象に対するオッズは 極めて低い。だから、 おそらくあなたは、 mがnより大きい、という事さえ注意しておけば、 多変量ガウス分布のモデルを シグマが非可逆である、という事を心配する事無く 適用する事が 出来るだろう。 さて、以上が多変量ガウス分布による アノマリー検出だ。 そしてこの手法を適用すれば、 あなたのフィーチャー間での 正や負の相関を自動で捉えるような アノマリー検出の アルゴリズムを得る事が出来、 そしてフィーチャーの値の組み合わせが 異常なのを目撃したら、 アノマリーだとフラグを立てる事が出来る。